# Тестирование уникальности деревьев решений

## Способы проверки

### 1. Автоматическое тестирование через Python скрипт (Рекомендуется)

```bash
# Запуск скрипта создания тестовых деревьев
docker-compose exec ai-agent python /app/create_test_trees.py
```

Этот скрипт:

- Создает 5 разных тестовых запросов
- Генерирует деревья решений для каждого запроса
- Анализирует уникальность созданных файлов
- Показывает ключевые поля каждого файла

### 2. Ручное тестирование через AI агент

```bash
# Выполнение разных запросов с визуализацией
echo "Проверить соответствие договора поставки" | docker-compose exec -T ai-agent poetry run python -m ai_agent.main query --web-visualization

echo "Найти информацию о регистрации ООО" | docker-compose exec -T ai-agent poetry run python -m ai_agent.main query --web-visualization

echo "Какие документы нужны для тендера?" | docker-compose exec -T ai-agent poetry run python -m ai_agent.main query --web-visualization
```

### 3. Сравнение существующих файлов

```bash
# Анализ уже созданных файлов
./compare_trees.sh
```

## Что проверять

### В JSON файлах должны отличаться:

1. **ID дерева** - уникальный UUID для каждого дерева
2. **Timestamp** - время создания с точностью до микросекунд
3. **Query Text** - текст запроса пользователя
4. **Root Label** - заголовок корневого узла с информацией о запросе
5. **Root Description** - описание с контекстом запроса

### Пример различий:

```json
// Файл 1
{
  "id": "a1b2c3d4-...",
  "timestamp": "2024-07-23T01:30:45.123456",
  "query_text": "Проверить соответствие договора поставки",
  "root": {
    "label": "Проверка соответствия (01:30:45)",
    "description": "Анализ соответствия документа | Контекст: Проверить соответствие договора поставки"
  }
}

// Файл 2
{
  "id": "e5f6g7h8-...",
  "timestamp": "2024-07-23T01:30:47.654321",
  "query_text": "Найти информацию о регистрации ООО",
  "root": {
    "label": "Обработка запроса: Найти информацию о регистрации ООО",
    "description": "Анализ запроса пользователя: 'Найти информацию о регистрации ООО'"
  }
}
```

## Проверка в веб-интерфейсе

1. Откройте http://localhost:8501
2. В боковой панели должны отображаться разные деревья
3. Каждое дерево должно иметь уникальное название
4. При выборе разных деревьев должна отображаться разная информация

## Ожидаемые результаты

✅ **Успешный тест:**

- Все файлы имеют разные MD5 хеши
- Каждый файл содержит уникальный ID
- Временные метки отличаются
- Описания узлов содержат информацию о конкретном запросе

❌ **Неуспешный тест:**

- Файлы имеют одинаковые MD5 хеши
- ID деревьев повторяются
- Описания узлов одинаковые для разных запросов

## Устранение проблем

Если тесты показывают одинаковые файлы:

1. Проверьте, что изменения в коде применены:

   ```bash
   git pull
   docker-compose up -d --build
   ```

2. Очистите старые файлы:

   ```bash
   rm -f /tmp/decision_trees_analysis/*.json
   ```

3. Перезапустите тестирование
