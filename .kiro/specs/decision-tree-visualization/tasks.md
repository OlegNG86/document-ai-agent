# Задачи по реализации системы визуализации деревьев решений

## Базовая инфраструктура

- [x] 1. Создание базовой структуры проекта для визуализации

  - Создать директорию `visualization/` в корне проекта
  - Создать файлы `Dockerfile`, `requirements.txt` и `app.py`
  - Создать директорию `data/decision_trees` для хранения данных
  - _Requirements: 2.1, 2.2_

- [x] 2. Настройка Docker-образа для Streamlit

  - Создать Dockerfile на базе Python 3.9
  - Добавить необходимые зависимости в requirements.txt
  - Настроить точку входа для запуска Streamlit
  - Настроить порты и тома для данных
  - _Requirements: 2.1, 2.2, 2.3_

- [x] 3. Интеграция с docker-compose
  - Добавить сервис `decision-tree-viz` в docker-compose.yml
  - Настроить зависимости между сервисами
  - Настроить общие тома для обмена данными
  - Настроить переменные окружения
  - _Requirements: 2.1, 2.2, 2.4_

## Экспорт данных из AI агента

- [x] 4. Создание модуля экспорта деревьев решений

  - Создать файл `ai_agent/utils/tree_exporter.py`
  - Реализовать функцию конвертации дерева решений в JSON
  - Добавить функцию сохранения JSON в файл
  - Реализовать генерацию уникальных идентификаторов для деревьев
  - _Requirements: 3.1, 3.2_

- [x] 5. Интеграция экспорта в процессор запросов

  - Модифицировать `ai_agent/core/query_processor.py`
  - Добавить вызов экспорта дерева после его создания
  - Добавить опцию включения/выключения экспорта
  - Добавить логирование процесса экспорта
  - _Requirements: 3.1, 3.2, 3.3_

- [x] 6. Добавление CLI опций для визуализации
  - Модифицировать `ai_agent/cli/commands.py`
  - Добавить опцию `--web-visualization`
  - Добавить вывод URL для доступа к веб-интерфейсу
  - Сохранить обратную совместимость с текстовым выводом
  - _Requirements: 1.1, 1.2, 7.1, 7.2_

## Веб-интерфейс визуализации

- [x] 7. Создание базового Streamlit приложения

  - Реализовать структуру приложения в `app.py`
  - Добавить заголовки и описания
  - Настроить макет страницы
  - Добавить боковую панель с настройками
  - _Requirements: 1.1, 1.2, 1.3_

- [x] 8. Реализация загрузки данных деревьев решений

  - Создать функцию для сканирования директории с деревьями
  - Реализовать загрузку JSON-файлов
  - Добавить парсинг метаданных деревьев
  - Реализовать сортировку и фильтрацию деревьев
  - _Requirements: 1.1, 1.2_

- [x] 9. Создание визуализации графа с NetworkX и Plotly

  - Реализовать функцию построения графа из данных дерева
  - Добавить расчет позиций узлов
  - Настроить цветовое кодирование вероятностей
  - Добавить интерактивные подсказки при наведении
  - _Requirements: 1.1, 1.2, 1.3, 1.4_

- [x] 10. Добавление интерактивных элементов управления
  - Реализовать выбор дерева из списка
  - Добавить масштабирование и перемещение по графу
  - Реализовать фильтрацию узлов по вероятности
  - Добавить переключение между различными макетами графа
  - _Requirements: 1.1, 1.3_

## Расширенная функциональность

- [x] 11. Реализация экспорта визуализаций

  - Добавить кнопки экспорта в PNG, SVG, PDF
  - Реализовать функции генерации файлов
  - Настроить качество и размеры экспортируемых изображений
  - Добавить возможность скачивания файлов
  - _Requirements: 4.1, 4.2, 4.3_

- [x] 12. Добавление анализа путей принятия решений

  - Реализовать расчет всех возможных путей в дереве
  - Добавить расчет вероятностей для каждого пути
  - Создать таблицу с путями и их характеристиками
  - Добавить сортировку и фильтрацию путей
  - _Requirements: 1.3, 1.4_

- [x] 13. Реализация сравнения деревьев решений

  - Добавить возможность выбора нескольких деревьев
  - Реализовать визуализацию различий между деревьями
  - Добавить статистику сравнения
  - Создать таблицу с ключевыми различиями
  - _Requirements: 1.1, 1.3_

- [x] 14. Добавление настроек визуализации
  - Реализовать выбор цветовой схемы
  - Добавить настройки отображения вероятностей
  - Реализовать переключение между режимами отображения
  - Добавить сохранение пользовательских настроек
  - _Requirements: 5.1, 5.2, 5.3_

## Оптимизация и тестирование

- [ ] 15. Оптимизация производительности

  - Реализовать кэширование данных деревьев
  - Оптимизировать алгоритмы построения графов
  - Добавить прогресс-индикаторы для длительных операций
  - Реализовать ленивую загрузку данных
  - _Requirements: 6.1, 6.2, 6.3_

- [ ] 16. Обработка больших деревьев решений

  - Реализовать упрощение сложных деревьев
  - Добавить постраничное отображение больших графов
  - Реализовать свертывание/развертывание поддеревьев
  - Оптимизировать память при работе с большими деревьями
  - _Requirements: 6.1, 6.2, 6.3, 6.4_

- [ ] 17. Создание тестов для системы визуализации

  - Написать unit-тесты для модуля экспорта
  - Создать тесты для проверки корректности построения графов
  - Добавить тесты для проверки экспорта файлов
  - Реализовать интеграционные тесты с AI агентом
  - _Requirements: 6.1, 6.2_

- [ ] 18. Настройка мониторинга и логирования
  - Добавить логирование операций в Streamlit приложении
  - Реализовать сбор метрик использования
  - Добавить отслеживание ошибок
  - Настроить оповещения о проблемах
  - _Requirements: 6.1, 6.2_

## Документация и развертывание

- [ ] 19. Создание документации по использованию

  - Написать README для директории visualization
  - Создать инструкцию по запуску и использованию
  - Добавить примеры использования
  - Создать документацию по API экспорта деревьев
  - _Requirements: 7.1, 7.2, 7.3_

- [ ] 20. Обновление основной документации проекта
  - Добавить раздел о визуализации в README.md
  - Обновить инструкции по запуску с docker-compose
  - Добавить скриншоты интерфейса визуализации
  - Обновить раздел о дереве решений
  - _Requirements: 7.1, 7.2, 7.3_
